In this repository there is sample data to try the graph builder. There are some requisites:
* Have a mongoDB running. Here the information about the graphs will be dumped into different collections. The machine it resides in can be controlled with the mongodb variable in the graph_builder.py script
* Set the names_start_end in the graph_builder.py script. These are triples (name, start, end) with the name we want to give to the graph in the mongodb and
the start and end timestamp that we want to use within the sysdig and prometheus data to build the graph
* Set an experiments_res_path in the graph_builder.py script. It must have a collection of sysdig dumps for each host, and a experiment_log.pickle file, which is a pandas dataframe with the start and end of the anomalies injected in the testbed. 
See experiment_log.csv for a representation in a comma separated format or pickle the file to explore it as a pandas DF
You can use this sample_data directory as a sample experiments_res_path
* Set a prometheus_path in the graph_builder.py script. This is the Prometheus endpoint used to retrieve the metrics
* Set a gephx_output_path in the graph_builder.py script. 

The outputs of the graph_builder are contained in the outputs subdirectory.  

#### How to get your own sysdig dumps.

Here we provide some sample sysdig dumps (10.136.41.*.scrap.gz files). In case you want to generate your own in your testbed you should launch sysdig as a container with the following arguments

`sudo docker run -i -t --name sysdig --privileged -v /var/run/docker.sock:/host/var/run/docker.sock -v /dev:/host/dev -v /proc:/host/proc:ro -v /boot:/host/boot:ro -v /lib/modules:/host/lib/modules:ro -v /usr:/host/usr:ro -v /home/vagrant:/host/vagrant sysdig/sysdig sysdig "not(proc.name contains stress-ng)" and "(fd.type=ipv4 or fd.type=ipv6)" and evt.is_io=true -p"%evt.rawtime.s,%fd.num,%fd.type,%evt.type,%evt.dir,%proc.name,%proc.pid,%container.name,%container.image,%container.id,%container.type,%fd.name,%fd.cip,%fd.sip,%fd.lip,%fd.rip,%fd.is_server,%fd.cport,%fd.sport,%fd.lport,%fd.rport,%fd.l4proto,%evt.io_dir,%evt.category,%evt.rawarg.res" > /home/vagrant/{{{host}}}.scrap'`     

This will monitor all the network communication between containers and hosts and dump it into a text file. The `not(proc.name contains stress-ng)` is specific to our use case since we did not want to monitor any traffic generated by the stress-ng process. This can be changed depending on your use case  